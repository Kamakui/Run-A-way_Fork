using System.Collections;
using System.Collections.Generic;
using UnityEngine;
using Hojnun;
using Hojun;
using Gayoung;
using Photon.Pun;
using Photon.Realtime;

namespace Jinho
{
    #region Item_interface
    public enum ItemType
    {
        Rifle,
        Shotgun,
        Melee,
        Handgun,
        HealKit,
        Grenade,
    }
    public interface IUseable
    {
        public ItemType ItemType { get; }
        public Player Player { get; set; }
        public IAttackStrategy AttackStrategy { get; set; }
        public void Use();
        public void UseEffect();
        [PunRPC]
        public void SetItem(Player player);
    }
    public interface IAttackItemable : IUseable
    {
        public WeaponData WeaponData { get; }

    }
    public interface IExpendable : IUseable
    {
        public ExtendableData ExtendableData { get; }
    }
    #endregion
    #region Weapon_Class
    public class WeaponItem
    {
        [PunRPC]
        public static void SetWeapon(Player player, GameObject weaponObj, int slotIndex, IAttackItemable attackItemable)
        {
            if (player.weaponObjSlot[slotIndex] != null)
            {

                GameObject temp = player.weaponObjSlot[slotIndex];
                Vector3 tempPos = weaponObj.transform.position;

                player.weaponObjSlot[slotIndex] = weaponObj;
                temp.GetComponent<IAttackItemable>().Player = null;

                temp.transform.position = tempPos;
                weaponObj.GetComponent<IAttackItemable>().Player = player;

                temp.SetActive(true);
                temp.GetComponent<Collider>().enabled = true;

                if (player.weaponIndex == slotIndex)   //플레이어가 슬롯의 무기를 들고있을 때,
                {
                    //SetStrategy(player, weaponObj);
                    player.attackState = weaponObj.GetComponent<IAttackItemable>().ItemType;  //player가 그 슬롯의 무기를 들도록 설정
                    player.currentItemObj = player.weaponObjSlot[slotIndex];
                    player.currentItem = player.currentItemObj.GetComponent<IUseable>();
                }
                else                               //플레이어가 슬롯의 무기를 돌고있지 않을 때,
                {
                    weaponObj.SetActive(false);
                }
            
            }
            else
            {           //플레이어의 슬롯이 비었으면
                player.weaponObjSlot[slotIndex] = weaponObj;
                player.attackState = weaponObj.GetComponent<IAttackItemable>().ItemType;
                weaponObj.SetActive(false);
                weaponObj.GetComponent<IAttackItemable>().Player = player;
            }
            weaponObj.GetComponent<Collider>().enabled = false;
        }
        public static void SetStrategy(Player player, GameObject weaponObj)
        {
            IAttackItemable attackItemable = weaponObj.GetComponent<IAttackItemable>();
            switch (attackItemable.ItemType)
            {
                case ItemType.Rifle:
                    attackItemable.AttackStrategy = new RifleAttackStrategy(player);
                    break;
                case ItemType.Shotgun:
                    attackItemable.AttackStrategy = new ShotGunStregy(player);
                    break;
                case ItemType.Handgun:
                    attackItemable.AttackStrategy = new HandgunAttackStrategy(player);
                    break;
                case ItemType.Melee:
                    attackItemable.AttackStrategy = new MeleeAttackStrategy(player);
                    break;
                case ItemType.HealKit:
                    //attackItemable.AttackStrategy = new HealKitAttackStrategy(player);
                    break;
                case ItemType.Grenade:
                    attackItemable.AttackStrategy = new GranadeAttackStrategy(player);
                    break;
            }
            player.attackStrategy = attackItemable.AttackStrategy;
        }
    }
    public class WeaponMonoBehaviour : MonoBehaviour
    {
        [SerializeField]protected  int maxTotalBullet;         //최대로 내가 가지고 있는 총알의 합계
        [SerializeField]protected int totalBullet;            //내가 가지고 있는 총알의 합계
        [SerializeField]protected int maxBullet;       //장전되는 총알 양
        [SerializeField]protected int bulletCount;            //현재 총에 들어있는 총알 양

        public int BulletCount
        {
            get { return bulletCount; }
            set
            {
                bulletCount = value;
                if (bulletCount > maxBullet) bulletCount = maxBullet;
                if (bulletCount < 0) bulletCount = 0;
            }
        }
        public int TotalBullet
        {
            get { return totalBullet; }
            set
            {
                totalBullet = value;
                if (totalBullet > maxTotalBullet) totalBullet = maxTotalBullet;
                if (totalBullet < 0) totalBullet = 0;
            }
        }
    }
    #endregion
}
